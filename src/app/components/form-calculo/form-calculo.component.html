<div class="container mt-5">
    <form #form="ngForm" (ngSubmit)="calcular(form)">

        <div class="form-group">
            <div class="row">
                <div class="col-8">
                    <label for="propietario">Propietario</label>
                    <input [(ngModel)]="propietario"
                        [ngClass]="{'is-invalid': form.submitted && form.controls['propietario'] && form.controls['propietario'].errors}"
                        required type="text" class="form-control" id="propietario" name="propietario"
                        placeholder="Propietario">
                </div>
                <div class="col-2">
                    <label for="tarifa">Tarifa Actual</label>
                    <select [(ngModel)]="tarifa"
                        [ngClass]="{'is-invalid': form.submitted && form.controls['tarifa'].errors}" required
                        name="tarifa" class="form-control">
                        <option *ngFor="let tarifa of tarifas" [value]="tarifa.tarifa">{{tarifa.tarifa}}</option>
                    </select>
                    <div *ngIf="form.submitted && form.controls['tarifa'].errors" class="invalid-feedback">
                        Este campo es obligatorio
                    </div>
                </div>
                <div class="col-2">
                    <label for="fijoIndexado">Fijo / Indexado / Plana</label>
                    <select [(ngModel)]="fijoIndexado"
                        [ngClass]="{'is-invalid': form.submitted && form.controls['fijoIndexado'].errors}" required
                        name="fijoIndexado" class="form-control">
                        <option value="fijo">Fijo</option>
                        <option value="indexado">Indexado</option>
                        <option value="plana">Plana</option>
                    </select>
                    <div *ngIf="form.submitted && form.controls['fijoIndexado'].errors" class="invalid-feedback">
                        Este campo es obligatorio
                    </div>
                </div>

            </div>

            <br>

            <div class="row">
                <div class="col-12">
                    <label for="tarifa">Observaciones</label>
                    <textarea [(ngModel)]="observaciones" name="observaciones" class="form-control"></textarea>
                </div>
            </div>
        </div>

        <div class="form-check-inline">
            <input [(ngModel)]="comparadorPrecios" type="checkbox" class="form-check-input" name="comparadorPrecios"
                id="comparadorPrecios">
            <label for="comparadorPrecios" class="form-check-label">Comparador de precios</label>
        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="text-center">Potencia Tarifa Actual</h5>
            </div>
            <div class="form-group card-body">
                <div class="row">

                    <div class="col-4">
                        <label for="p1Calculos">P1 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="p1"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p1'] && form.controls['p1'].errors}"
                                number required type="number" class="form-control" id="p1" name="p1" placeholder="(P1)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p1'] && form.controls['p1'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifa != '2.0A' && tarifa != '2.0DHA' && tarifa != '2.0DHS' && tarifa != '2.1A' && tarifa != '2.1DHA' && tarifa != '2.1DHS'">
                        <label for="p2">P2 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="p2"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p2'] && form.controls['p2'].errors}"
                                number required type="number" class="form-control" id="p2" name="p2" placeholder="(P2)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p2'] && form.controls['p2'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifa != '2.0A' && tarifa != '2.0DHA' && tarifa != '2.0DHS' && tarifa != '2.1A' && tarifa != '2.1DHA' && tarifa != '2.1DHS'">
                        <label for="p3">P3 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="p3"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p3'] && form.controls['p3'].errors}"
                                number required type="number" class="form-control" id="p3" name="p3" placeholder="(P3)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p3'] && form.controls['p3'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="form-group card-body" *ngIf="esTarifa6x(tarifa)">
                <div class="row">

                    <div class="col-4">
                        <label for="p4">P4 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="p4"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p4'] && form.controls['p4'].errors}"
                                number required type="number" class="form-control" id="p4" name="p4" placeholder="(P4)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p4'] && form.controls['p4'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="p5">P5 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="p5"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p5'] && form.controls['p5'].errors}"
                                number required type="number" class="form-control" id="p5" name="p5" placeholder="(P5)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p5'] && form.controls['p5'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="p6">P6 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="p6"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p6'] && form.controls['p6'].errors}"
                                number required type="number" class="form-control" id="p6" name="p6" placeholder="(P6)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p6'] && form.controls['p6'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexado != 'plana'">
            <div class="card-header">
                <h5 class="text-center">Precio Potencia Tarifa Actual</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">

                    <div class="col-4">
                        <label for="precioP1">Precio P1 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="precioP1" number type="number" class="form-control" id="precioP1"
                                name="precioP1" placeholder="Precio P1">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifa != '2.0A' && tarifa != '2.0DHA' && tarifa != '2.0DHS' && tarifa != '2.1A' && tarifa != '2.1DHA' && tarifa != '2.1DHS'">
                        <label for="precioP2">Precio P2 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="precioP2" number type="number" class="form-control" id="precioP2"
                                name="precioP2" placeholder="Precio P2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifa != '2.0A' && tarifa != '2.0DHA' && tarifa != '2.0DHS' && tarifa != '2.1A' && tarifa != '2.1DHA' && tarifa != '2.1DHS'">
                        <label for="precioP3">Precio P3 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="precioP3" number type="number" class="form-control" id="precioP3"
                                name="precioP3" placeholder="Precio P3">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="form-group card-body" *ngIf="esTarifa6x(tarifa)">
                <div class="row">

                    <div class="col-4">
                        <label for="precioP4">Precio P4 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="precioP4" number type="number" class="form-control" id="precioP4"
                                name="precioP4" placeholder="Precio P4">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioP5">Precio P5 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="precioP5" number type="number" class="form-control" id="precioP5"
                                name="precioP5" placeholder="Precio P5">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioP6">Precio P6 Tarifa Actual</label>
                        <div class="input-group">
                            <input [(ngModel)]="precioP6" number type="number" class="form-control" id="precioP6"
                                name="precioP6" placeholder="Precio P6">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexado == 'fijo'">

            <div class="card-header">
                <h5 class="text-center">Precio Energía Tarifa Actual</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">

                    <div class="col-4">
                        <label for="precioE1Actual">Precio E1 Tarifa Actual</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE1Actual" number type="number" class="form-control"
                                id="precioE1Actual" name="precioE1Actual" placeholder="Precio E1 Actual">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifa != '2.0A' && tarifa != '2.0DHA' && tarifa != '2.1A' && tarifa != '2.1DHA'">
                        <label for="precioE2Actual">Precio E2 Tarifa Actual</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE2Actual" number type="number" class="form-control"
                                id="precioE2Actual" name="precioE2Actual" placeholder="Precio E2 Actual">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4" *ngIf="tarifa != '2.0A' && tarifa != '2.1A'">
                        <label for="precioE3Actual">Precio E3 Tarifa Actual</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE3Actual" number type="number" class="form-control"
                                id="precioE3Actual" name="precioE3Actual" placeholder="Precio E3 Actual">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="form-group card-body" *ngIf="esTarifa6x(tarifa)">
                <div class="row">

                    <div class="col-4">
                        <label for="precioE4Actual">Precio E4 Tarifa Actual</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE4Actual" number type="number" class="form-control"
                                id="precioE4Actual" name="precioE4Actual" placeholder="Precio E4 Actual">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioE5Actual">Precio E5 Tarifa Actual</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE5Actual" number type="number" class="form-control"
                                id="precioE5Actual" name="precioE5Actual" placeholder="Precio E5 Actual">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioE6Actual">Precio E6 Tarifa Actual</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE6Actual" number type="number" class="form-control"
                                id="precioE6Actual" name="precioE6Actual" placeholder="Precio E6 Actual">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexado == 'indexado'">

            <div class="card-header">
                <h5 class="text-center">Precio Energía Tarifa Actual</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">
                    <div class="col-10">
                        <label for="formulaIndexadoActual">Fórmula</label>
                        <input required [(ngModel)]="formulaIndexadoActual" class="form-control"
                            name="formulaIndexadoActual">
                    </div>
                    <div class="col-2">
                        <label for="fee">Fee</label>
                        <div class="input-group">
                            <input [(ngModel)]="fee"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['fee'] && form.controls['fee'].errors}"
                                number required type="number" class="form-control" id="fee" name="fee"
                                placeholder="fee">
                            <div class="input-group-prepend">
                                <div class="input-group-text">eMWh</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['fee'] && form.controls['fee'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexado == 'plana'">

            <div class="card-header">
                <h5 class="text-center">Precio Tarifa Plana</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">
                    <div class="col-4">
                        <label for="preMensPlanaAct">Tarifa Mes</label>
                        <div class="input-group">
                            <input [(ngModel)]="preMensPlanaAct" number type="number" required class="form-control"
                                name="preMensPlanaAct" placeholder="€ / Mes">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <label for="inicioPenalizacionAct">Inicio Penalización</label>
                        <div class="input-group">
                            <input [(ngModel)]="inicioPenalizacionAct" number type="number" required
                                class="form-control" name="inicioPenalizacionAct" placeholder="Inicio Penalización">
                            <div class="input-group-prepend">
                                <div class="input-group-text">kW</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <label for="penalizacionAct">Penalización / kW</label>
                        <div class="input-group">
                            <input [(ngModel)]="penalizacionAct" number type="number" required class="form-control"
                                name="penalizacionAct" placeholder="€ / kW">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="mt-4">
            <div class="form-check-inline">
                <label class="form-check-label">
                    <input [(ngModel)]="calculoAutomatico" value="si" type="radio" class="form-check-input"
                        name="tipoCalculo">Cálculo de Potencias Automático
                </label>
            </div>
            <div class="form-check-inline">
                <label class="form-check-label">
                    <input [(ngModel)]="calculoAutomatico" value="no" type="radio" class="form-check-input"
                        name="tipoCalculo">Cálculo de Potencias Manual
                </label>
            </div>
        </div>

        <div class="form-group mt-4">
            <div class="row">
                <div class="col-2">
                    <label for="tarifaOptimizada">Tarifa Optimizada</label>
                    <select [(ngModel)]="tarifaOptimizada"
                        [ngClass]="{'is-invalid': form.submitted && form.controls['tarifaOptimizada'].errors}" required
                        name="tarifaOptimizada" class="form-control">
                        <option *ngFor="let tarifa of tarifas" [value]="tarifa.tarifa">{{tarifa.tarifa}}</option>
                    </select>
                    <div *ngIf="form.submitted && form.controls['tarifaOptimizada'].errors" class="invalid-feedback">
                        Este campo es obligatorio
                    </div>
                </div>
                <div class="col-2">
                    <label for="fijoIndexadoOptimizada">Fijo / Indexado / Plana</label>
                    <select [(ngModel)]="fijoIndexadoOptimizada"
                        [ngClass]="{'is-invalid': form.submitted && form.controls['fijoIndexadoOptimizada'].errors}"
                        required name="fijoIndexadoOptimizada" class="form-control">
                        <option value="fijo">Fijo</option>
                        <option value="indexado">Indexado</option>
                        <option value="plana">Plana</option>
                    </select>
                    <div *ngIf="form.submitted && form.controls['fijoIndexadoOptimizada'].errors"
                        class="invalid-feedback">
                        Este campo es obligatorio
                    </div>
                </div>
            </div>
        </div>

        <div class="card mt-4" *ngIf="calculoAutomatico == 'no'">
            <div class="card-header">
                <h5 class="text-center">Potencia Tarifa Optimizada</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">

                    <div class="col-4">
                        <label for="p1Calculos">P1 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input [(ngModel)]="p1Calculos"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p1Calculos'] && form.controls['p1Calculos'].errors}"
                                number required type="number" class="form-control" id="p1Calculos" name="p1Calculos"
                                placeholder="(P1)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p1Calculos'] && form.controls['p1Calculos'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifaOptimizada != '2.0A' && tarifaOptimizada != '2.0DHA' && tarifaOptimizada != '2.0DHS' && tarifaOptimizada != '2.1A' && tarifaOptimizada != '2.1DHA' && tarifaOptimizada != '2.1DHS'">
                        <label for="p2Calculos">P2 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input [(ngModel)]="p2Calculos"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p2Calculos'] && form.controls['p2Calculos'].errors}"
                                number required type="number" class="form-control" id="p2Calculos" name="p2Calculos"
                                placeholder="(P2)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p2Calculos'] && form.controls['p2Calculos'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifaOptimizada != '2.0A' && tarifaOptimizada != '2.0DHA' && tarifaOptimizada != '2.0DHS' && tarifaOptimizada != '2.1A' && tarifaOptimizada != '2.1DHA' && tarifaOptimizada != '2.1DHS'">
                        <label for="p3Calculos">P3 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input [(ngModel)]="p3Calculos"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p3Calculos'] && form.controls['p3Calculos'].errors}"
                                number required type="number" class="form-control" id="p3Calculos" name="p3Calculos"
                                placeholder="(P3)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p3Calculos'] && form.controls['p3Calculos'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="form-group card-body" *ngIf="esTarifa6x(tarifaOptimizada)">
                <div class="row">

                    <div class="col-4">
                        <label for="p4Calculos">P4 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input [(ngModel)]="p4Calculos"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p4Calculos'] && form.controls['p4Calculos'].errors}"
                                number required type="number" class="form-control" id="p4Calculos" name="p4Calculos"
                                placeholder="(P4)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p4Calculos'] && form.controls['p4Calculos'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="p5Calculos">P5 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input [(ngModel)]="p5Calculos"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p5Calculos'] && form.controls['p5Calculos'].errors}"
                                number required type="number" class="form-control" id="p5Calculos" name="p5Calculos"
                                placeholder="(P5)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p5Calculos'] && form.controls['p5Calculos'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="p6Calculos">P6 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input [(ngModel)]="p6Calculos"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['p6Calculos'] && form.controls['p6Calculos'].errors}"
                                number required type="number" class="form-control" id="p6Calculos" name="p6Calculos"
                                placeholder="(P6)">
                            <div class="input-group-prepend">
                                <div class="input-group-text">ekW</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['p6Calculos'] && form.controls['p6Calculos'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexadoOptimizada != 'plana'">

            <div class="card-header">
                <h5 class="text-center">Precio Potencia Tarifa Optimizada</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">

                    <div class="col-4">
                        <label for="precioP1">Precio P1 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required="{{comparadorPrecios}}" [(ngModel)]="precioP1opt" number type="number"
                                class="form-control" name="precioP1opt" placeholder="Precio P1 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifaOptimizada != '2.0A' && tarifaOptimizada != '2.0DHA' && tarifaOptimizada != '2.0DHS' && tarifaOptimizada != '2.1A' && tarifaOptimizada != '2.1DHA' && tarifaOptimizada != '2.1DHS'">
                        <label for="precioP2">Precio P2 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required="{{comparadorPrecios}}" [(ngModel)]="precioP2opt" number type="number"
                                class="form-control" name="precioP2opt" placeholder="Precio P2 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifaOptimizada != '2.0A' && tarifaOptimizada != '2.0DHA' && tarifaOptimizada != '2.0DHS' && tarifaOptimizada != '2.1A' && tarifaOptimizada != '2.1DHA' && tarifaOptimizada != '2.1DHS'">
                        <label for="precioP3">Precio P3 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required="{{comparadorPrecios}}" [(ngModel)]="precioP3opt" number type="number"
                                class="form-control" name="precioP3opt" placeholder="Precio P3 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="form-group card-body" *ngIf="esTarifa6x(tarifaOptimizada)">
                <div class="row">

                    <div class="col-4">
                        <label for="precioP4">Precio P4 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required="{{comparadorPrecios}}" [(ngModel)]="precioP4opt" number type="number"
                                class="form-control" name="precioP4opt" placeholder="Precio P4 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioP5">Precio P5 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required="{{comparadorPrecios}}" [(ngModel)]="precioP5opt" number type="number"
                                class="form-control" name="precioP5opt" placeholder="Precio P5 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioP6">Precio P6 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required="{{comparadorPrecios}}" [(ngModel)]="precioP6opt" number type="number"
                                class="form-control" name="precioP6opt" placeholder="Precio P6 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexadoOptimizada == 'fijo'">

            <div class="card-header">
                <h5 class="text-center mt-1">Precio Energía Tarifa Optimizada</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">

                    <div class="col-4">
                        <label for="precioE1Optimizada">Precio E1 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE1Optimizada" number type="number" class="form-control"
                                id="precioE1Optimizada" name="precioE1Optimizada" placeholder="Precio E1 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4"
                        *ngIf="tarifaOptimizada != '2.0A' && tarifaOptimizada != '2.0DHA' && tarifaOptimizada != '2.1A' && tarifaOptimizada != '2.1DHA'">
                        <label for="precioE2Optimizada">Precio E2 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE2Optimizada" number type="number" class="form-control"
                                id="precioE2Optimizada" name="precioE2Optimizada" placeholder="Precio E2 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4" *ngIf="tarifaOptimizada != '2.0A' && tarifaOptimizada != '2.1A'">
                        <label for="precioE3Optimizada">Precio E3 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE3Optimizada" number type="number" class="form-control"
                                id="precioE3Optimizada" name="precioE3Optimizada" placeholder="Precio E3 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="form-group card-body" *ngIf="esTarifa6x(tarifaOptimizada)">
                <div class="row">

                    <div class="col-4">
                        <label for="precioE4Optimizada">Precio E4 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE4Optimizada" number type="number" class="form-control"
                                id="precioE4Optimizada" name="precioE4Optimizada" placeholder="Precio E4 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioE5Optimizada">Precio E5 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE5Optimizada" number type="number" class="form-control"
                                id="precioE5Optimizada" name="precioE5Optimizada" placeholder="Precio E5 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                    <div class="col-4">
                        <label for="precioE6Optimizada">Precio E6 Tarifa Optimizada</label>
                        <div class="input-group">
                            <input required [(ngModel)]="precioE6Optimizada" number type="number" class="form-control"
                                id="precioE6Optimizada" name="precioE6Optimizada" placeholder="Precio E6 Optimizada">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexadoOptimizada == 'indexado'">

            <div class="card-header">
                <h5 class="text-center mt-1">Precio Energía Tarifa Optimizada</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">
                    <div class="col-10">
                        <label for="formulaIndexadoOptim">Fórmula</label>
                        <input required [(ngModel)]="formulaIndexadoOptim" class="form-control"
                            name="formulaIndexadoOptim">
                    </div>
                    <div class="col-2">
                        <label for="fee">Fee</label>
                        <div class="input-group">
                            <input [(ngModel)]="feeOpt"
                                [ngClass]="{'is-invalid': form.submitted && form.controls['feeOpt'] && form.controls['feeOpt'].errors}"
                                number required type="number" class="form-control" id="feeOpt" name="feeOpt"
                                placeholder="fee">
                            <div class="input-group-prepend">
                                <div class="input-group-text">eMWh</div>
                            </div>
                            <div *ngIf="form.submitted && form.controls['feeOpt'] && form.controls['feeOpt'].errors"
                                class="invalid-feedback">
                                Este campo es obligatorio
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="card mt-4" *ngIf="fijoIndexadoOptimizada == 'plana'">

            <div class="card-header">
                <h5 class="text-center">Precio Tarifa Plana</h5>
            </div>

            <div class="form-group card-body">
                <div class="row">
                    <div class="col-4">
                        <label for="preMensPlanaOpt">Tarifa Mes</label>
                        <div class="input-group">
                            <input [(ngModel)]="preMensPlanaOpt" number type="number" required class="form-control"
                                name="preMensPlanaOpt" placeholder="€ / Mes">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <label for="inicioPenalizacionOpt">Inicio Penalización</label>
                        <div class="input-group">
                            <input [(ngModel)]="inicioPenalizacionOpt" number type="number" required
                                class="form-control" name="inicioPenalizacionOpt" placeholder="Inicio Penalización">
                            <div class="input-group-prepend">
                                <div class="input-group-text">kW</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-4">
                        <label for="penalizacionOpt">Penalización / kW</label>
                        <div class="input-group">
                            <input [(ngModel)]="penalizacionOpt" number type="number" required class="form-control"
                                name="penalizacionOpt" placeholder="€ / kW">
                            <div class="input-group-prepend">
                                <div class="input-group-text">€</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="card mt-4">
            <div class="card-header">
                <h5 class="text-center">Impuestos y Descuentos</h5>
            </div>
            <div class="form-group card-body">
                <div class="row">

                    <div class="col-2">
                        <label for="descuentoGeneral">Des General Act</label>
                        <div class="input-group">
                            <input required [(ngModel)]="descuentoGeneral" number type="number" class="form-control"
                                id="descuentoGeneral" name="descuentoGeneral" placeholder="Descuento General">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <label for="descuentoPotencia">Des Potencia Act</label>
                        <div class="input-group">
                            <input required [(ngModel)]="descuentoPotencia" number type="number" class="form-control"
                                id="descuentoPotencia" name="descuentoPotencia" placeholder="Descuento Potencia">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <label for="descuentoEnergia">Des Energía Act</label>
                        <div class="input-group">
                            <input required [(ngModel)]="descuentoEnergia" number type="number" class="form-control"
                                id="descuentoEnergia" name="descuentoEnergia" placeholder="Descuento Energía">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <label for="conceptoDescuento">Concepto Descuento Actual</label>
                        <input required [(ngModel)]="conceptoDescuento" class="form-control" id="conceptoDescuento"
                            name="conceptoDescuento" placeholder="Concepto descuento">
                    </div>

                    <div class="col-2">
                        <label for="descuentoGeneralOpt">Des General Opt</label>
                        <div class="input-group">
                            <input required [(ngModel)]="descuentoGeneralOpt" number type="number" class="form-control"
                                id="descuentoGeneralOpt" name="descuentoGeneralOpt" placeholder="Descuento General">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <label for="descuentoPotenciaOpt">Des Potencia Opt</label>
                        <div class="input-group">
                            <input required [(ngModel)]="descuentoPotenciaOpt" number type="number" class="form-control"
                                id="descuentoPotenciaOpt" name="descuentoPotenciaOpt" placeholder="Descuento Potencia">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-2">
                        <label for="descuentoEnergiaOpt">Des Energía Opt</label>
                        <div class="input-group">
                            <input [(ngModel)]="descuentoEnergiaOpt" number type="number" class="form-control"
                                id="descuentoEnergiaOpt" name="descuentoEnergiaOpt" placeholder="Descuento Energía">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <label for="conceptoDescuentoOpt">Concepto Descuento Optimizado</label>
                        <input [(ngModel)]="conceptoDescuentoOpt" class="form-control"
                            id="conceptoDescuentoOpt" name="conceptoDescuentoOpt" placeholder="Concepto descuento">
                    </div>

                    <div class="col-2">
                        <label for="impuestoElectrico">Impuesto Eléctrico</label>
                        <div class="input-group">
                            <input required [(ngModel)]="impuestoElectrico" number type="number" class="form-control"
                                id="impuestoElectrico" name="impuestoElectrico" placeholder="Impuesto Eléctrico">
                            <div class="input-group-prepend">
                                <div class="input-group-text">%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="form-group mt-4">
            <div class="row">
                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                    <table class="table table-light">
                        <thead>
                            <tr>
                                <th>Nombre Archivo Adjunto</th>
                                <th>
                                    <button *ngIf="archivos.length > 0" (click)="eliminarArchivos()"
                                        class="btn btn-danger btn-sm btn-block">Eliminar Todos</button>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let archivo of archivos">
                                <td [ngClass]="{'text-green': archivo.progreso >= 100}">
                                    {{ archivo.nombreArchivo }}</td>
                                <td>
                                    <button (click)="eliminarArchivo(archivo)"
                                        class="btn btn-danger btn-sm btn-block">Eliminar</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12 col-xs-12">
                    <label>Adjuntar archivo</label>
                    <div appNgDropFiles [archivos]="archivos" (mouseSobre)="estaSobreElemento = $event"
                        [ngClass]="{'file-over': estaSobreElemento}" class="well drop-zone">
                        <label class="inputFile" for="cajaEjemplo">Arrastre sus archivos o pulse aquí para
                            adjuntar archivos</label>
                        <input class="inputFile" id="cajaEjemplo" type="file" (change)="cargarFichero($event)">
                    </div>
                </div>
            </div>
        </div>

        <br>

        <button [disabled]="form.invalid" type="submit" class="btn btn-primary">Calcular</button>

    </form>

    <div class="mt-4">

        <h5 class="text-center">Consultas previas</h5>

        <div class="mt-3" *ngFor="let res of historico; let i = index">
            <div class="card">
                <div class="card-body rounded bg-dark text-white">
                    <div class="row">
                        <div class="col-3">
                            Propietario: <span class="font-weight-bold">{{res.propietario}}</span>
                        </div>
                        <div class="col-2">
                            Tarifa: <span class="font-weight-bold">{{res.tarifa}}</span>
                        </div>
                        <div class="col-2">
                            Tipo Tarifa: <span class="font-weight-bold">{{res.tipo_tarifa_actual}}</span>
                        </div>
                        <div class="col-2">
                            Tarifa Nueva: <span class="font-weight-bold">{{res.tarifa_nueva}}</span>
                        </div>
                        <div class="col-3 text-right">
                            Tipo Tarifa Nueva: <span class="font-weight-bold">{{res.tipo_tarifa_nueva}}</span>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-4">
                            Cups: <span class="font-weight-bold">{{res.cups}}</span>
                        </div>
                        <div class="col-8 text-right">
                            F. Alta: <span
                                class="font-weight-bold">{{res.fecha_alta | date:'dd/MM/yyyy HH:mm:ss'}}</span>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            Observaciones: <span class="font-weight-bold">{{res.observaciones}}</span>
                        </div>
                    </div>
                    <div class="row mt-3 text-center">
                        <div class="col-2 offset-4">
                            <button (click)="cargar(i)" class="btn btn-success">Cargar</button>
                        </div>
                        <div class="col-2">
                            <button (click)="borrarRegistro(res.fecha_alta)" class="btn btn-danger">Borrar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- <tr *ngFor="let res of historico; let i = index">
            <td>{{res.propietario}}</td>
            <td>{{res.tarifa}}</td>
            <td>{{res.cups}}</td>
            <td>{{res.fecha_alta | date:'dd/MM/yyyy HH:mm:ss'}}</td>
            <td><button (click)="cargar(i)" class="btn btn-success">Cargar</button></td>
            <td><button (click)="borrarRegistro(res.fecha_alta)" class="btn btn-danger">Borrar</button></td>
        </tr> -->

    </div>

    <div class="mt-4">

        <h5 class="text-center">Consultas previas</h5>

        <table class="table table-striped table-dark text-center">
            <thead>
                <tr>
                    <th scope="col">Propietario</th>
                    <th scope="col">Tarifa</th>
                    <th scope="col">CUPS</th>
                    <th scope="col">Fecha consulta</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let res of historico; let i = index">
                    <td>{{res.propietario}}</td>
                    <td>{{res.tarifa}}</td>
                    <td>{{res.cups}}</td>
                    <td>{{res.fecha_alta | date:'dd/MM/yyyy HH:mm:ss'}}</td>
                    <td><button (click)="cargar(i)" class="btn btn-success">Cargar</button></td>
                    <td><button (click)="borrarRegistro(res.fecha_alta)" class="btn btn-danger">Borrar</button></td>
                </tr>
            </tbody>
        </table>

    </div>
</div>